<apex:page standardController="amc__Project__c" tabStyle="amc__Project__c" standardStylesheets="false" sidebar="false">
    <apex:includeScript value="{!URLFOR($Resource.amc__js, '/jquery/dist/jquery.min.js')}" />
    <apex:includeScript value="/support/console/55.0/integration.js" />
    
    <apex:slds />    
    <apex:includeLightning />

    <style>
        html,
		body {
			height: 100%;
		}
    </style>

    <script>
        $(document).ready(function () {
			$(window).resize(function () {
				setHeight();
			});
			setHeight();
		});

		function setHeight() {
			//window heights
			var winHeight = $('body').height();
			//footer height
			var footerHeight = $('div.bPageFooter').outerHeight(true);
			var headerHeight = $('div.bPageHeader').outerHeight(true);
			//calculate our window height
			var pageHeight = winHeight-footerHeight-headerHeight;
			$('div#planner').height(pageHeight);
		}

        var loadMilestones = function() {
            var projectId = '{!Project__c.Id}';
            $Lightning.use("amc:CreateMilestonesApp", function() {
                $Lightning.createComponent("amc:createMilestones",
                {
                    'recordId' : projectId
                },
                "milestones",
                function(cmp) {
                    
                    var showToast = function (event) {
                          sforce.one.showToast({
                            'title': event.detail.title,
                            'message': event.detail.message,
                            'type': event.detail.type //supported types are error, success, info, warning
                        });
                    };

                    var redirect = function (event) {
                        sforce.one.navigateToSObject(event.detail.recordId);
                    }

                    //Add a listener for the 'showtoast' & 'redirect' event type
                    document.querySelector('amc-create-milestones').addEventListener('showtoast', showToast);
                    document.querySelector('amc-create-milestones').addEventListener('redirect', redirect);
                });
            });
        }

        loadMilestones();
    </script>

    <div id="milestones" style="width:100%; height:90%;" />
</apex:page>